<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gooey Nav</title>
<link rel="stylesheet" href="GooeyNav.css">
</head>
<body>

<div class="gooey-nav-container" id="gooey-container">
  <nav>
    <ul id="gooey-nav">
      <li class="active"><a href="#">Home</a></li>
      <li><a href="#">Search</a></li>
      <li><a href="#">Profile</a></li>
      <li><a href="#">Settings</a></li>
    </ul>
  </nav>

  <span class="effect filter" id="gooey-filter"></span>
  <span class="effect text" id="gooey-text"></span>
</div>

<script>
/* -------------------- CONFIG -------------------- */
const animationTime = 600;
const particleCount = 15;
const particleDistances = [90, 10];
const particleR = 100;
const timeVariance = 300;
const colors = [1, 2, 3, 1, 2, 3, 1, 4];

/* -------------------- ELEMENTS -------------------- */
const container = document.getElementById("gooey-container");
const nav = document.getElementById("gooey-nav");
const filterEl = document.getElementById("gooey-filter");
const textEl = document.getElementById("gooey-text");

let activeIndex = 0;

/* -------------------- HELPERS -------------------- */
const noise = n => n / 2 - Math.random() * n;

function getXY(distance, pointIndex, totalPoints) {
  const angle = ((360 + noise(8)) / totalPoints) * pointIndex * (Math.PI / 180);
  return [distance * Math.cos(angle), distance * Math.sin(angle)];
}

function createParticle(i, t, d, r) {
  let rotate = noise(r / 10);
  return {
    start: getXY(d[0], particleCount - i, particleCount),
    end: getXY(d[1] + noise(7), particleCount - i, particleCount),
    time: t,
    scale: 1 + noise(0.2),
    color: colors[Math.floor(Math.random() * colors.length)],
    rotate: rotate > 0 ? (rotate + r / 20) * 10 : (rotate - r / 20) * 10
  };
}

function makeParticles(element) {
  const d = particleDistances;
  const r = particleR;
  const bubbleTime = animationTime * 2 + timeVariance;
  element.style.setProperty("--time", `${bubbleTime}ms`);

  for (let i = 0; i < particleCount; i++) {
    const t = animationTime * 2 + noise(timeVariance * 2);
    const p = createParticle(i, t, d, r);

    element.classList.remove("active");

    setTimeout(() => {
      const particle = document.createElement("span");
      const point = document.createElement("span");

      particle.classList.add("particle");
      particle.style.setProperty("--start-x", `${p.start[0]}px`);
      particle.style.setProperty("--start-y", `${p.start[1]}px`);
      particle.style.setProperty("--end-x", `${p.end[0]}px`);
      particle.style.setProperty("--end-y", `${p.end[1]}px`);
      particle.style.setProperty("--time", `${p.time}ms`);
      particle.style.setProperty("--scale", `${p.scale}`);
      particle.style.setProperty("--color", `var(--color-${p.color}, white)`);
      particle.style.setProperty("--rotate", `${p.rotate}deg`);

      point.classList.add("point");
      particle.appendChild(point);
      element.appendChild(particle);

      requestAnimationFrame(() => element.classList.add("active"));

      setTimeout(() => {
        try { element.removeChild(particle); } catch {}
      }, t);

    }, 30);
  }
}

function updateEffectPosition(element) {
  const containerRect = container.getBoundingClientRect();
  const pos = element.getBoundingClientRect();

  const style = {
    left: `${pos.x - containerRect.x}px`,
    top: `${pos.y - containerRect.y}px`,
    width: `${pos.width}px`,
    height: `${pos.height}px`
  };

  Object.assign(filterEl.style, style);
  Object.assign(textEl.style, style);

  textEl.textContent = element.innerText;
}

/* -------------------- INTERACTIONS -------------------- */
function handleClick(li, index) {
  if (activeIndex === index) return;

  activeIndex = index;

  updateEffectPosition(li);

  filterEl.querySelectorAll(".particle").forEach(p => p.remove());

  textEl.classList.remove("active");
  void textEl.offsetWidth;
  textEl.classList.add("active");

  makeParticles(filterEl);

  document.querySelectorAll("#gooey-nav li").forEach(li => li.classList.remove("active"));
  li.classList.add("active");
}

/* -------------------- INIT -------------------- */
document.querySelectorAll("#gooey-nav li").forEach((li, index) => {
  li.addEventListener("click", () => handleClick(li, index));
});

window.addEventListener("resize", () => {
  const activeLi = document.querySelectorAll("#gooey-nav li")[activeIndex];
  updateEffectPosition(activeLi);
});

window.onload = () => {
  const activeLi = document.querySelectorAll("#gooey-nav li")[activeIndex];
  updateEffectPosition(activeLi);
  textEl.classList.add("active");
};
</script>

</body>
</html>
